---
title: "Gov 50 Final Project"
author: "Yunzhi Liu"
description: "My final project - editted Oct13"
output:
  distill::distill_article:
    self_contained: false
editor_options: 
  markdown: 
    wrap: sentence
---

## Project thoughts

I use the data from this study: #Nicholas D.
Anderson, "Introducing the Warring States Japan Battle Data," International Interactions, Latest articles (2022) <https://doi.org/10.1080/03050629.2023.2149514>

```{r}
library(tidyverse)
library(broom)
library(infer)
library(readr)

rm(warstate)

battledata <- read_csv("~/Desktop/harvard/GOV50/final project potential dataset/WSJBData/WarringStatesJapan_battledataV1.csv")
# View(WarringStatesJapan_battledataV1)

dyadic_data <- read_csv("~/Desktop/harvard/GOV50/final project potential dataset/WSJBData/WarringStatesJapan_diffusiondata_dyadic.csv")

monadic_data<- read_csv("~/Desktop/harvard/GOV50/final project potential dataset/WSJBData/WarringStatesJapan_diffusiondata_monadic.csv")

battledata <- rename(battledata, province_name = province)


warringstate <- merge(battledata, monadic_data, by.x = c('year', 'province_name'), by.y = c('year', 'province'), all.x = TRUE)

```

```{r}
warringstate |>
  filter(!is.na(province_name), !is.na(region), !is.na(naval))

rm(df)

warringstate$naval <- as.integer(warringstate$naval)
```

**Getting familiar with Japan's Warring State Battles**

*#Inland or Near-Shore*

```{r}
#Define Inland and Near-shore Provinces
near_shore_provinces <- c("yamashiro", "ise", "harima", "hizen", "kii", "settsu", "bizen", "aki", "chikuzen", "bingo", "buzen", "nagato", "suo", "awa1", "izu", "tsushima", "izumo", "iki", "musashi", "toutoumi", "osumi", "satsuma", "sagami","tosa", "houki", "ecchu", "higo", "hyuuga", "sanuki", "bungo", "iyo", "oki", "noto", "awa2", "awaji", "sado")

inland_provinces <- c("yamato", "tanba", "shinano", "mimasaka", "oumi", "tajima", "kaga", "kawachi", "mino", "owari", "echizen", "kai", "tango", "bicchu", "mutsu", "shimotsuke", "izumi", "shimousa", "kazusa", "kouzuke", "chikugo", "inaba", "hitachi", "echigo", "mikawa", "iga", "wakasa", "dewa", "iwami", "hida", "suruga")

warringstate <- warringstate |>
  mutate(
    geography = case_when(
    province_name %in% inland_provinces ~ "inland",
    province_name %in% near_shore_provinces ~ "shore"),
    battle_geography = if_else(naval == 1, "Naval Battle", "Land Battle"),
    naval = as.factor(naval))


landshore_plot <- warringstate |>
  mutate(shore = if_else(geography == "shore", 1, 0)) |>
  group_by(year, shore) |>
  summarize(count = n(), .groups = 'drop') |>
  ggplot(aes(x = year, y = count)) +
  geom_point() +
  geom_smooth(na.rm = FALSE) +
  facet_wrap(~ shore, labeller = as_labeller(c('0' = 'no. of battles in inland provinces', '1' = 'no. of battles in shore provinces')))

landshore_plot
```

Analysis: We see a significant rise in numbers of battles, both in inland provinces and shore provinces, after the 1550s.
The rise is proportionally faster/more significant in inland provinces as compared to shore provinces.

This lead to a question: is the more significant increase in number in inland provinces due to the rise of cavalry?

*#Calvary & Time & Location*

```{r}
warringstate <- warringstate |>
  mutate(cavalryA = if_else(str_detect(forcesA, "cavalry"), 1, 0),
         cavalryB = if_else(str_detect(forcesB, "cavalry"), 1, 0),
         cavalry = if_else(cavalryA == 1|cavalryB == 1, 1, 0))

cavalry_battle <- warringstate |>
  filter(cavalry == 1) |>
  group_by(year)|>
  summarize(count = n()) |>
  ggplot(aes(x = year, y = count))+
  geom_point() +
  geom_smooth(na.rm = FALSE) +
    labs(
    title = "Total Number of Cavalry Battles",
    x = "Year",
    y = "No. of Cavalry Battles"
  )
cavalry_battle

#proportion of cavalry-involved battle each year
total_prop_cavalry <- warringstate |>
  group_by(year) |>
  summarize(
    total_battles = n(), 
    cavalry_battles = sum(cavalry, na.rm = TRUE), 
    proportion_cavalry = cavalry_battles / total_battles
  ) |>
  filter(proportion_cavalry > 0)

total_prop_cavalry_plot <-
  ggplot(total_prop_cavalry, aes(x = year, y = proportion_cavalry)) +
  geom_point() + geom_smooth() +
   scale_y_log10() +
  labs(
    title = "Proportion of Calvary Battles Over Years",
    x = "Year",
    y = "Proportion of Cavalry Battles"
  )

#proportion of cavalry-involved LAND battle each year
land_prop_cavalry <- warringstate |>
  filter(naval == 0) |>
  group_by(year) |>
  summarize(
    total_battles = n(), 
    cavalry_battles = sum(cavalry, na.rm = TRUE), 
    proportion_cavalry = cavalry_battles / total_battles
  ) |>
  filter(proportion_cavalry > 0)

land_prop_cavalry_plot <- 
ggplot(land_prop_cavalry, aes(x = year, y = proportion_cavalry)) +
  geom_point() + geom_smooth() +
   scale_y_log10() +
  labs(
    title = "Proportion of Cavalry LAND Battles Over Years",
    x = "Year",
    y = "Proportion of Cavalry LAND Battles"
  )

library(patchwork)

total_prop_cavalry_plot + land_prop_cavalry_plot

```

Analysis: Although there is a sharp increase in the total number of cavalry battles form the 1560s to the 1600s, there is no significant increase in the proportion of cavalry-involved battles.
Additionally, the proportion of cavalry battles is so small over all recorded years indicates that there is no significant relationship between the rise in total battle numbers and cavalry battle numbers we should pay attention to.
Therefore, we cannot conclude that the increase in total number of battles is caused by the increase in cavalry.
Neither is there any observable correlation between the rise in inland battle numbers and the rise in cavalry.
Therefore, we do not have sufficient information to say that the significant increase in number of battles in inland provinces is correlated to due to the rise of cavalry.

Nevertheless, the trend in the cavalry proportion in inland battles matches the smoothline in the total cavalry proportion change over years.
This observation reinforces the common assumption that cavalries tend to participate in purely inland battles, although Japan is a rather small archipelago.

*#Road Battle*

Anderson in his paper narrates that, "adjacent_battle simply indicates whether a province sharing a land border with a given province experienced conflict within the past 24 months; road_battle adds the condition that this adjacent province also shares a major road with the province in question." (Anderson, 7) This inspires me to compare the numbers of adjacent_battle and road_battle overtime, to see if there is any divergent in the change in battle numbers that may indicate an improvement in road infrastructure correlated to a rise in road battle numbers.

```{r}
battle_summary <- warringstate |>
  group_by(year) |>
  summarize(road_battles = sum(road_battle, na.rm = TRUE),
            adjacent_battles = sum(adjacent_battle, na.rm = TRUE))

road_vs_adjacent <- battle_summary |>
  ggplot(aes(x = year)) +
  geom_line(aes(y = road_battles, color = "Road Battles"), size = 1.2, alpha = 1) +
  geom_line(aes(y = adjacent_battles, color = "Adjacent Battles"), size = 1.2, alpha = 0.8) +
  scale_color_manual(values = c("Road Battles" = "blue", "Adjacent Battles" = "indianred1")) +
  labs(title = "Road Battles vs Adjacent Battles",
       x = "Year", y = "Number of Battles",
       color = "Battle Type") 
road_vs_adjacent

```

Analysis: From this plot, we can observe that over time there are similar trends in the frequency of battles taking place where major road connections exist and simply with adjacent states.
It is therefore hard to conclude that an improvement in road infrastructure correlated to a rise in road-specific battles, since adjacent battle numbers always rise and fall together with the number of road battles.

**Regression**

*#Predicting Terrain Ruggedness based on Battle features Naval, Siege, and Cavalry*

```{r}
model_terrain <- 
  lm(terrain_ruggedness ~ naval + siege + cavalry, data = warringstate)
summary(model_terrain)
```

```{r}
modelsummary::modelsummary(model_terrain,
                           statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"),
                           gof_map = c("nobs", "r.squared", "adj.r.squared"))
```

```{r}
tidy_model_terrain <- tidy(model_terrain)

ggplot(tidy_model_terrain, aes(x = term, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = estimate - std.error, ymax = estimate + std.error), width = 0.2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Regression Coefficients of Model 1: Terrain Ruggedness",
       x = "Predictors",
       y = "Coefficient Estimate") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Analysis & Interpretation:
